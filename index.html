<!doctype html>
<html lang="ja" data-theme="light" xmlns="http://www.w3.org/1999/html">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    html[data-theme="dark"] {
      background-color: #121212;
      color-scheme: dark;
    }

    html[data-theme="light"] {
      background-color: #ffffff;
      color-scheme: light;
    }
  </style>
  <title>Portal_1</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #f4f7f9;
      --text-color: #333;
      --card-bg: #fff;
      --card-shadow: rgba(0, 0, 0, 0.1);
      --header-gradient: linear-gradient(90deg, #2196f3, #21cbf3);
      --link-color: #2196f3;
      --main-color: #00aaff;
    }

    [data-theme="dark"] {
      --bg-color: #111111;
      --text-color: #eaeaea;
      --card-bg: #1e1e1e;
      --card-shadow: rgba(0, 0, 0, 0.6);
      --header-gradient: linear-gradient(90deg, #333, #444);
      --link-color: #90caf9;
    }


    body {
      font-family: 'Noto Sans JP', sans-serif;
      margin: 0;
      background: var(--bg-color);
      color: var(--text-color);
      transition: background 0.3s, color 0.3s;
    }

    header {
      background: var(--header-gradient);
      padding: 0.8rem 1.2rem;
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    header h1 a {
      color: white;
      text-decoration: none;
      font-size: 1.8rem;
      font-weight: 700;
    }

    nav {
      display: flex;
      gap: 1rem;
      flex-grow: 1;
    }

    nav a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: 0.3s;
    }

    nav a:hover {
      text-decoration: underline;
    }


    .main-container {
      /*max-width: 1800px;*/
      margin: 3rem auto 0;
      padding: 0 2rem;
    }

    .widgets {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      grid-auto-rows: 10px;
      gap: 1rem;
      align-items: start;
      /*max-width: 1100px;*/
      margin: 0 auto;
    }


    .widgets .card {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 2px 8px var(--card-shadow);
      grid-row-end: span var(--row-span, 20);
      cursor: default;
      transition: transform 0.3s ease, box-shadow 0.25s ease;
      margin-bottom: 16px;
      /* ã‚«ãƒ¼ãƒ‰é–“ã®ä¸‹ä½™ç™½ã‚’çµ±ä¸€ */
      padding: 20px;
      /* ã‚«ãƒ¼ãƒ‰å†…ã®ä½™ç™½ */
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .weather {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .weather .meta p {
      margin: 0.1rem 0;
      /* ä¸Šä¸‹ã®ä½™ç™½ã‚’æœ€å°é™ã« */
    }

    .weekly-weather table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.6rem;
      font-size: 14px;
    }

    .weekly-weather th,
    .weekly-weather td {
      padding: 3px;
      text-align: center;
    }

    .weekly-weather th {
      border-bottom: 1px solid #ddd;
      /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®ä¸‹ã«ç·š */
      background: var(--bg-color);
      font-weight: bold;
    }

    .weekly-weather td {
      border-bottom: 1px solid #ddd;
      /* è¡Œã”ã¨ã®ä¸‹ç·š */
      background: var(--card-bg);
    }

    .weather .icon {
      font-size: 3rem;
      width: 72px;
      height: 72px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      background: var(--bg-color);
    }

    .forecast {
      margin-top: 1rem;
      border-collapse: collapse;
      width: 100%;
      font-size: 14px;
    }

    .forecast th,
    .forecast td {
      border-bottom: 1px solid #ddd;
      padding: 4px 8px;
      /* ä¸Šä¸‹ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å°ã•ã */
      text-align: center;
    }

    .forecast th {
      background: var(--bg-color);
    }

    .forecast td {
      /* heightã¯å‰Šé™¤ */
    }

    .loading {
      color: #777;
      font-size: 0.95rem;
    }

    .error {
      color: #d9534f;
    }

    #result {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #result li {
      margin-bottom: 0.8rem;
    }

    .eq {
      background: var(--bg-color);
      padding: 1rem;
      border-radius: 8px;
      border-left: 6px solid #21cbf3;
    }

    .eq .meta {
      font-size: 0.95rem;
      color: var(--text-color);
    }

    .ac-parent {
      display: inline-block;
      background: rgba(255, 170,100,0.5);
      font-weight: bold;
      text-align: center;
      color: var(--text-color);
      padding: 0.6rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 0.6rem;
      transition: 0.2s;
    }

    .ac-parent:hover {
      background: rgba(255, 170,100,1);
    }

    /* --- ã‚‚ã£ã¨è¦‹ã‚‹ / å…¨éƒ¨é–‰ã˜ã‚‹ ãƒœã‚¿ãƒ³ã‚’ ac-parent ã¨çµ±ä¸€ --- */
.eq-btn {
  display: inline-block;
  background: rgba(255, 152,0,0.80);
  font-weight: bold;
  text-align: center;
  color: var(--text-color);
  padding: 0.6rem 0.8rem;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 0.6rem;
  border: none;
}

.eq-btn:hover {
  background: #e68900;
}

    .ac-child {
      display: none;
      padding: 0.8rem;
      border-radius: 6px;
      margin-top: 0.5rem;
      font-size: 0.95rem;
      background: var(--card-bg);
      position: relative;
    }

    .point-row {
      padding: 4px 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.04);
    }

    .scale-badge {
      display: inline-block;
      min-width: 36px;
      text-align: center;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
      margin-left: 8px;
      color: white;
      font-size: 0.85rem;
    }

    .scale-1 {
      background: #81d4fa;
    }

    .scale-2 {
      background: #0288d1;
    }

    .scale-3 {
      background: #81c784;
    }

    .scale-4 {
      background: #ffeb3b;
      color: #333;
    }

    .scale-5 {
      background: #ff9800;
    }

    .scale-6 {
      background: #f44336;
    }

    .scale-7 {
      background: #6a1b9a;
    }

    .currency-converter {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin-top: 1rem;
      align-items: center;
    }

    .currency-input,
    #from,
    #to {
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      flex: 1;
      min-width: 80px;
    }

    #convert {
      padding: 0.6rem 1.2rem;
      background: rgba(143, 207, 120,0.5);
      color: var(--text-color);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0s;
      font-weight: bold;
    }

    #convert:hover {
      background: rgba(143, 207, 120,1);
      transition: 0.3s;
    }

    .currency-result {
      margin-top: 1rem;
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--text-color);
    }

    button#edit-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 6px;
      background: #4caf50;
      color: #ffffff;
      font-weight: bold;
      cursor: pointer;
      z-index: 9999;
    }

    #theme-toggle {
      margin-left: 1rem;
      padding: 0.4rem 0.8rem;
      border: none;
      background: none;
      color: inherit;
      font-size: 1.5rem;
      cursor: pointer;
    }

    .calendar-card {
      border-radius: 16px;
    }

    .calendar-card h2 {
      text-align: left;
      margin: 0 0 1rem 0;
      padding: 0 12px;
    }

    .calendar {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border: 2px solid #000;
      border-radius: 12px;
      overflow: hidden;
      table-layout: fixed;
    }

    .calendar th,
    .calendar td {
      border: 1px solid rgba(0, 0, 0, 0.2);
      padding: 0.6rem;
      text-align: center;
    }

    .calendar th {
      background: rgba(0, 0, 0, 0.05);
      color: var(--text-color);
      font-weight: bold;
    }


    .calendar td {
      background: var(--card-bg);
      color: var(--text-color);
    }

    .calendar td.today {
      background: #bbdefb;
      color: #000;
      font-weight: bold;
      border-radius: 4px;
    }


    .calendar-nav button {
      background:  rgba(0,140,255,0.25);
      border: none;
      border-radius: 8px;
      padding: 0.4rem 1rem;
      cursor: pointer;
      color: var(--text-color);
      font-weight: bold;
      font-size: 1rem;
      box-shadow: 0 2px 6px var(--card-shadow);
      transition: background 0s, transform 0.1s;
    }

    .calendar-nav button:hover {
      background:  rgba(0,140,255,0.50);
      transform: scale(1.05);
    }

    .calendar-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
      position: relative;
    }

    .calendar-card .calendar-nav:last-of-type {
      display: flex;
      justify-content: flex-end;
      margin-top: 4px;
    }


    #calendar-title {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-weight: bold;
      font-size: 1.2rem;
    }

    html[data-theme="dark"].calendar {
      border-color: #dcdcdc;
      /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å…¨ä½“ã®æ ç·š */
    }

    html[data-theme="dark"] .calendar th {
      background-color: #dcdcdc;
      /* ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ã‚‚å°‘ã—æ˜ã‚‹ã */
      color: #000000;
      /* ãƒ†ã‚­ã‚¹ãƒˆè‰²ã‚’èª¿æ•´ */
    }

    html[data-theme="dark"] .calendar th,
    html[data-theme="dark"] .calendar td {
      border-color: #2e2e2e;
      /* ã‚»ãƒ«ã®æ ç·š */
    }

    .calendar td.saturday {
      color: blue;
    }

    /* æ—¥æ›œã¾ãŸã¯ç¥æ—¥ */
    .calendar td.sunday,
    .calendar td.holiday {
      color: red;
    }

    .today-card {
      margin-bottom: 0px;
      /* ä¸‹ã®ä½™ç™½ã‚’å°ã•ãã™ã‚‹ */
      padding: 10px;
      /* å†…å´ã®ä½™ç™½ã¯å¿…è¦ã«å¿œã˜ã¦èª¿æ•´ */
    }

    .widgets .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.18);
    }

    .widgets .card:active {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    body.dark .widgets .card:hover {
      box-shadow: 0 8px 18px rgba(255, 255, 255, 0.12);
    }

    #theme-toggle {
      margin-left: auto;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: inherit;
      font-size: 1.8rem;
      cursor: pointer;
      z-index: 1000;
    }

    .weather .meta {
      margin: 0;
      padding: 0;
      font-size: 0.95rem;
      line-height: 1.2;
      /* è¡Œé–“ã‚’è©°ã‚ã‚‹ */
    }

    .weather .meta p {
      margin: 2px 0;
      /* ä¸Šä¸‹ã®ä½™ç™½ã‚’æœ€å°é™ã« */
    }

    #draw-horoscope {
      padding: 0.6rem 1.2rem;
      background-color: rgba(206, 171, 255, 0.5);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0s;
    }

    #draw-horoscope:hover {
  background-color: rgba(206, 171, 255, 1);
  transition: 0.3s;
}

    #zodiac-select {
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      flex: 1;
      min-width: 80px;
    }

    #trend-list {
   list-style: none;
  padding-left: 0;
  margin-left: 0;
}

#trend-list li {
  list-style: none;
  padding-left: 0;
  margin-left: 0;
}

      #news-list a {
      list-style: none !important;
  all: unset !important;
  display: block !important;
  padding: 10px 14px !important;
  margin: 6px 0 !important;
  font-weight: 900 !important;
  color: var(--text-color) !important;
  background: rgba(0,140,255,0.25) !important;
  border-radius: 10px !important;
  cursor: pointer !important;
  transition: 0s !important;
}

#news-list a:hover {
  background: rgba(0,140,255,0.35) !important;
}

      #news-list {
  list-style: none !important;
  padding-left: 0 !important;
  margin-left: 0 !important;
}

#news-list li {
  list-style: none !important;
  padding-left: 0 !important;
  margin-left: 0 !important;
}

#clock {
    color: white;        /* æ–‡å­—è‰²ã‚’ç™½ã« */
    font-weight: bold;   /* å¤ªæ–‡å­—ã« */
    font-size: 1.8rem;
}
      /* ã‚¹ãƒãƒ›ã§éè¡¨ç¤º */
@media screen and (max-width: 768px) {
    #clock {
        display: none;
    }
}

   #campus-sites-card button {
  background-color:rgb(255, 69, 165,0.5);
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 0.5rem;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: bold;
  transition: 0.2s;
   color: var(--text-color)
}

#campus-sites-card button:hover {
  background-color: #ff45a5;
  transition: 0.5s;
}

      .eq-buttons button {
  flex: 1; /* æ¨ªå¹…å‡ç­‰ */
  background: rgba(255,152,129,0.8);
  color: var(--text-color);
  font-weight: bold;
  border: none;
  border-radius: 6px;
  padding: 0.6rem 0;
  cursor: pointer;
  text-align: center;
  transition: 0.2s;
}

.eq-buttons button:hover {
  background: rgba(255,152,129,1);
}

#sun-card h2 {
          margin-bottom: 0.5rem;
        }

        #sun-info {
          font-size: 1rem;
          line-height: 1.6;
        }
.Fort-btn {
          padding: 8px 16px;
          font-size: 0.95em;
          font-weight: 500;
          color: var(--text-color);
          background-color: rgba(107, 184, 255,0.3);
          font-weight: bold;
          /* WebClassã£ã½ã„é’ */
          border: none;
          border-radius: 4px;
          cursor: pointer;
          transition: background-color 0.2s;
          border-radius: 8px;
        }

        .Fort-btn:hover {
          background-color: rgba(107, 184, 255,1);
        }
        /* å ã„ã‚«ãƒ¼ãƒ‰ã®è»½å¾®ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆä»»æ„ï¼‰ */
        #fortune-card p {
          margin: 10px 0;
          font-size: 1.1em;
          font-weight: bold;
        }

        #fortune-card button {
          margin-right: 5px;
        }
  </style>
</head>

<body>
  <header>
    <h1><a href="#" onclick="location.reload(); return false;">Portal_1</a></h1>
    <nav></nav>
    <div id="clock"></div>
    <button class="theme-toggle" id="theme-toggle">ğŸŒ™</button>

    <script>
      (function () {
        const html = document.documentElement;
        const toggleBtn = document.getElementById("theme-toggle");

        //Android ã‹ã‚‰ãƒ†ãƒ¼ãƒå–å¾—
        let androidTheme = null;
        try {
          if (window.AndroidTheme && window.AndroidTheme.getThemeMode) {
            androidTheme = window.AndroidTheme.getThemeMode(); // 'dark' or 'light'
          }
        } catch (e) { }

        //ãƒ†ãƒ¼ãƒæ±ºå®š
        const savedTheme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches;
        const initialTheme = savedTheme || androidTheme || (prefersDark ? "dark" : "light");

        applyTheme(initialTheme);

        //åˆ‡æ›¿ãƒœã‚¿ãƒ³
        toggleBtn.addEventListener("click", () => {
          const current = html.getAttribute("data-theme") === "dark" ? "light" : "dark";
          applyTheme(current);
          localStorage.setItem("theme", current);

          //Androidã¸é€šçŸ¥
          if (window.AndroidTheme && window.AndroidTheme.setThemeMode) {
            window.AndroidTheme.setThemeMode(current);
          }
        });

        function applyTheme(theme) {
          html.setAttribute("data-theme", theme);
          toggleBtn.textContent = theme === "dark" ? "â˜€ï¸" : "ğŸŒ™";
        }

        // åˆå›ãƒ­ãƒ¼ãƒ‰ã§ Android ã®ãƒ†ãƒ¼ãƒã‚’å–å¾—
        if (androidTheme) {
          applyTheme(androidTheme);
        }
      })();
    </script>


  </header>

  <div class="main-container">
    <div class="widgets">

      <!-- å­¦å†…ã‚µã‚¤ãƒˆã‚¢ã‚¯ã‚»ã‚¹ -->
      <div class="card" id="campus-sites-card">
        <h2>å­¦å†…ã‚µã‚¤ãƒˆ</h2>
        <div style="display:flex; flex-direction:column; gap:0.6rem; margin-top:0.5rem;">
          <button
            onclick="window.open('https://webclass.nagoya-bunri.ac.jp/webclass/login.php?rnd=179fa&language=JAPANESE','_blank')"
            style="cursor:pointer; font-weight:bold;">WebClass</button>
          <button onclick="window.open('https://unipa.nagoya-bunri.ac.jp/uprx/up/pk/pky501/Pky50101.xhtml','_blank')"
            style="cursor:pointer; font-weight:bold;">UNIPA</button>
        </div>
      </div>

      <!-- ä»Šæ—¥ã¯ä½•ã®æ—¥ -->
      <div class="card" id="today-card">
        <h2>ä»Šæ—¥ã¯ä½•ã®æ—¥ï¼Ÿ</h2>
        <p id="today-info">èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>

      <!-- å¤©æ°— -->
      <div class="card" id="weather-card">
        <h2>å¤©æ°—</h2>
        <div id="weather">
          <div class="loading">èª­ã¿è¾¼ã¿ä¸­â€¦</div>
        </div>
      </div>

      <!--æ—¥ã®å‡ºãƒ»æ—¥ã®å…¥ã‚«ãƒ¼ãƒ‰ -->
      <div class="card" id="sun-card">
        <h2>æ—¥ã®å‡ºãƒ»æ—¥ã®å…¥</h2>
        <div id="sun-info">èª­ã¿è¾¼ã¿ä¸­...</div>
      </div>

      <!-- ç‚ºæ›¿ -->
      <div class="card" id="kawase-card">
        <h2>ç‚ºæ›¿</h2>
        <div id="exchange-rate" class="currency-result">èª­ã¿è¾¼ã¿ä¸­...</div>
        <div class="currency-converter">
          <input type="number" id="amount" value="1" class="currency-input">
          <select id="from">
            <option value="USD" selected>USD</option>
            <option value="JPY">JPY</option>
          </select>
          <span>â†’</span>
          <select id="to">
            <option value="JPY" selected>JPY</option>
            <option value="USD">USD</option>
          </select>
          <button id="convert">æ›ç®—</button>
        </div>
        <div id="currency-result" class="currency-result"></div>
        <canvas id="rateChart"></canvas>
      </div>

      <!-- ä»Šæ—¥ã®æ˜Ÿåº§å ã„ã‚«ãƒ¼ãƒ‰ -->
      <div class="card" id="horoscope-card">
        <h2>ä»Šæ—¥ã®æ˜Ÿåº§å ã„</h2>
        <div style="display:flex; gap:0.6rem; align-items:center; flex-wrap:wrap;">
          <select id="zodiac-select" aria-label="æ˜Ÿåº§">
            <option value="aries">ç‰¡ç¾Šåº§</option>
            <option value="taurus">ç‰¡ç‰›åº§</option>
            <option value="gemini">åŒå­åº§</option>
            <option value="cancer">èŸ¹åº§</option>
            <option value="leo">ç…å­åº§</option>
            <option value="virgo">ä¹™å¥³åº§</option>
            <option value="libra">å¤©ç§¤åº§</option>
            <option value="scorpio">è åº§</option>
            <option value="sagittarius">å°„æ‰‹åº§</option>
            <option value="capricorn">å±±ç¾Šåº§</option>
            <option value="aquarius">æ°´ç“¶åº§</option>
            <option value="pisces">é­šåº§</option>
          </select>
          <button id="draw-horoscope"
            style="padding:0.5rem 1rem;border-radius:8px;border:none;color:var(--text-color);cursor:pointer;font-weight:bold;">å ã†</button>
        </div>
        <p id="horoscope-result" style="margin-top:0.8rem;font-weight:bold;">é¸ã‚“ã§ã€Œå ã†ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
      </div>


      <!-- åœ°éœ‡æƒ…å ± -->
        <div class="card" id="eq-card">
            <h2>æœ€æ–°ã®åœ°éœ‡æƒ…å ±</h2>
            <ul id="result">
                <li class="loading">å–å¾—ä¸­â€¦</li>
            </ul>

            <div class="eq-buttons" style="display:flex; gap:0.5rem; margin-top:0.6rem;">
                <button id="eq-load-more">ã‚‚ã£ã¨è¦‹ã‚‹</button>
                <button id="eq-close-all" style="display:none;">é–‰ã˜ã‚‹</button>
            </div>
        </div>

        <!-- ãƒ‹ãƒ¥ãƒ¼ã‚¹ -->
      <div class="card" id="news-card">
        <h2>æ—¥æœ¬ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹</h2>
        <ul id="news-list">
          <li class="loading">å–å¾—ä¸­â€¦</li>
        </ul>
      </div>

      <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
      <div class="card" id="calendar-card">
        <h2>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
        <div class="calendar-nav">
          <button id="prev-month" aria-label="å‰æœˆ">â†</button>
          <span id="calendar-title"></span>
          <button id="next-month" aria-label="æ¬¡æœˆ">â†’</button>
        </div>
        <div id="calendar"></div>
        <div class="calendar-nav"
          style="display: flex; justify-content: flex-end; margin-top: 17px;margin-bottom: 0px;">
          <button id="today-month" aria-label="ä»Šæœˆã¸">ä»Šæœˆã«æˆ»ã‚‹</button>
        </div>
      </div>



        <div class="card" id="memo-card">
            <h2>ç°¡æ˜“ãƒ¡ãƒ¢å¸³</h2>
            <textarea id="simple-memo" placeholder="ã“ã“ã«ãƒ¡ãƒ¢ã‚’å…¥åŠ›... (è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™)"
                      style="
            width: 100%;
            height: 120px;
            padding: 10px;
            box-sizing: border-box;
            border-radius: 8px;
            border: 1px solid #ccc;
            resize: vertical;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: inherit;
            font-size: 0.95rem;
            outline: none;
          "></textarea>
            <div style="text-align:right; margin-top:5px;">
                <button onclick="document.getElementById('simple-memo').value=''; localStorage.removeItem('portalMemo');"
                        style="font-size:0.8rem; padding:4px 8px; cursor:pointer; background:#f44336; color:white; border:none; border-radius:4px;">
                    å…¨æ¶ˆå»
                </button>
            </div>
        </div>

      <!-- äº¤é€šæƒ…å ±ã‚«ãƒ¼ãƒ‰ -->
      <div class="card" id="traffic-card">
        <h2>é‰„é“é…å»¶æƒ…å ±Î²</h2>
        <ul id="traffic-list">
          <li class="loading">èª­ã¿è¾¼ã¿ä¸­â€¦</li>
        </ul>
      </div>

      <!-- æ—¢å­˜ã®ã‚«ãƒ¼ãƒ‰ç¾¤ã®ä¸­ã«è¿½åŠ  -->
      <div class="card" id="fortune-card">
        <h2>ãŠã¿ãã˜</h2>
        <p id="fortune-result">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­â†“</p>
        <button class="Fort-btn" onclick="showFortune()">å ã†</button>
      </div>

        <!-- ä»Šæ—¥ã®ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ¯ãƒ¼ãƒ‰ -->
        <div class="card" id="trend-card">
            <h2>ä»Šæ—¥ã®ãƒˆãƒ¬ãƒ³ãƒ‰</h2>
            <ul id="trend-list">
                <li class="loading">èª­ã¿è¾¼ã¿ä¸­...</li>
            </ul>
        </div>
    </div>
  </div>
    </br></br></br></br></br>
  <button id="edit-btn">ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</button>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <!-- ä»Šæ—¥ã¯ä½•ã®æ—¥ -->
  <script>
    function showTodayInfo() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const dd = String(today.getDate()).padStart(2, "0");
      const key = `${yyyy}-${mm}-${dd}`;

      const infoEl = document.getElementById("today-info");

      // ç¥æ—¥ãŒã‚ã‚Œã°è¡¨ç¤º
      if (holidaysData[key]) {
        infoEl.textContent = holidaysData[key];
      } else {
        infoEl.textContent = "ç‰¹ã«ç¥æ—¥ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
      }
    }

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆå¾Œã«å‘¼ã³å‡ºã™
    document.addEventListener("DOMContentLoaded", () => {
      showTodayInfo();
    });

    // æœˆåˆ‡ã‚Šæ›¿ãˆã®å¾Œã«ã‚‚æ›´æ–°ã—ãŸã„å ´åˆ
    async function generateCalendarWithTodayInfo(year, month) {
      await generateCalendar(year, month);
      showTodayInfo();
    }
  </script>

  <!-- æ™‚è¨ˆ:ã„ã¤ã‹ä½¿ã†ã‹ã‚‚ -->
  <script>
    function updateClock() {
      const now = new Date();
      const y = now.getFullYear();
      const m = String(now.getMonth() + 1).padStart(2, '0');
      const d = String(now.getDate()).padStart(2, '0');
      const h = String(now.getHours()).padStart(2, '0');
      const mi = String(now.getMinutes()).padStart(2, '0');
      const week = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"][now.getDay()];
      document.getElementById("clock").textContent = `${y}/${m}/${d} (${week}) ${h}:${mi}`;
    }
    setInterval(updateClock, 1000);
    updateClock();
  </script>

  <!-- ç·¨é›†ãƒœã‚¿ãƒ³ï¼†ãƒ‰ãƒ©ãƒƒã‚° -->
  <script>
    let editMode = false;
    const widgets = document.querySelector(".widgets");
    const editBtn = document.getElementById("edit-btn");

    // éè¡¨ç¤ºã‚«ãƒ¼ãƒ‰æƒ…å ±
    const hiddenCardsKey = "hiddenCards";

    // ã€Œï¼‹ã‚«ãƒ¼ãƒ‰è¿½åŠ ã€ãƒœã‚¿ãƒ³
    const addBtn = document.createElement("button");
    addBtn.textContent = "å†è¡¨ç¤º";
    addBtn.style.display = "none";
    addBtn.style.padding = "0.6rem 1rem";
    addBtn.style.cursor = "pointer";
    addBtn.style.border = "none";
    addBtn.style.borderRadius = "8px";
    addBtn.style.fontWeight = "bold";
    addBtn.style.width = editBtn.offsetWidth + "px";
    addBtn.style.boxSizing = "border-box";
    addBtn.style.position = "fixed";
    addBtn.style.zIndex = "1000";
    document.body.appendChild(addBtn);

    // ã€Œã‚«ãƒ¼ãƒ‰é †åºå¤‰æ›´ã€ãƒœã‚¿ãƒ³
    const sortBtn = document.createElement("button");
    sortBtn.textContent = "é †åºå¤‰æ›´";
    sortBtn.style.display = "none";
    sortBtn.style.padding = "0.6rem 1rem";
    sortBtn.style.cursor = "pointer";
    sortBtn.style.border = "none";
    sortBtn.style.borderRadius = "8px";
    sortBtn.style.fontWeight = "bold";
    sortBtn.style.width = editBtn.offsetWidth + "px";
    sortBtn.style.boxSizing = "border-box";
    sortBtn.style.position = "fixed";
    sortBtn.style.zIndex = "1000";
    sortBtn.style.backgroundColor = "#FF69B4";
    document.body.appendChild(sortBtn);

    // ãƒœã‚¿ãƒ³ä½ç½®ï¼ˆç¸¦ã«ãã‚Œã„ã«æ•´åˆ—ï¼‰
function updateButtonPositions() {
  const rect = editBtn.getBoundingClientRect();
  const spacing = 10; // ãƒœã‚¿ãƒ³é–“éš”ï¼ˆpxï¼‰
  const btnHeight = rect.height;

  // ğŸ“Œ editBtnï¼ˆä¿å­˜/çµ‚äº†ï¼‰ãŒä¸€ç•ªä¸‹ â†’ ãã‚Œã‚’åŸºæº–ã«ç¸¦ã«ä¸Šã¸ç©ã‚€
  // å†è¡¨ç¤ºãƒœã‚¿ãƒ³
  addBtn.style.left = rect.left + "px";
  addBtn.style.bottom = (window.innerHeight - rect.bottom + btnHeight + spacing) + "px";

  // é †åºå¤‰æ›´ãƒœã‚¿ãƒ³ï¼ˆå†è¡¨ç¤ºãƒœã‚¿ãƒ³ã®ã•ã‚‰ã«ä¸Šï¼‰
  sortBtn.style.left = rect.left + "px";
  sortBtn.style.bottom = (window.innerHeight - rect.bottom + btnHeight * 2 + spacing * 2) + "px";
}

updateButtonPositions();
window.addEventListener("resize", updateButtonPositions);

    // åˆå›ãƒ­ãƒ¼ãƒ‰ã§ä¸¦ã³é †å¾©å…ƒ
    window.addEventListener("DOMContentLoaded", () => {
      const savedOrder = JSON.parse(localStorage.getItem("widgetOrder") || "[]");
      savedOrder.forEach(id => {
        const el = document.getElementById(id);
        if (el) widgets.appendChild(el);
      });
      updateHiddenCardsUI();
    });

    // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
    editBtn.addEventListener("click", () => {
      editMode = !editMode;

      widgets.querySelectorAll(".card").forEach(card => {
        card.setAttribute("draggable", editMode);
        card.style.cursor = editMode ? "move" : "default";
      });

      editBtn.textContent = editMode ? "ä¿å­˜ / çµ‚äº†" : "ç·¨é›†ãƒ¢ãƒ¼ãƒ‰";
      editBtn.style.backgroundColor = "#4caf50";
      editBtn.style.color = "#fff";
      editBtn.style.border = "none";
      editBtn.style.borderRadius = "8px";
      editBtn.style.padding = "0.6rem 1rem";
      editBtn.style.cursor = "pointer";
      editBtn.style.fontWeight = "bold";
      editBtn.style.boxSizing = "border-box";

      addBtn.style.display = editMode ? "block" : "none";
      sortBtn.style.display = editMode ? "block" : "none";

      if (!editMode) {
        const order = Array.from(widgets.children).map(el => el.id).filter(Boolean);
        localStorage.setItem("widgetOrder", JSON.stringify(order));
      }

      updateHiddenCardsUI();
    });

    // éè¡¨ç¤ºãƒœã‚¿ãƒ³ã¨å¾©æ´»ç”¨UI
    function updateHiddenCardsUI() {
      const hiddenCards = JSON.parse(localStorage.getItem(hiddenCardsKey) || "[]");

      document.querySelectorAll(".card").forEach(card => {
        card.style.display = hiddenCards.includes(card.id) ? "none" : "block";

        if (editMode && !card.querySelector(".edit-delete")) {
          const btn = document.createElement("button");
          btn.textContent = "éè¡¨ç¤º";
          btn.className = "edit-delete";
          btn.onclick = () => hideCard(card);
          btn.style.position = "absolute";
          btn.style.top = "5px";
          btn.style.right = "5px";
          btn.style.padding = "2px 6px";
          btn.style.cursor = "pointer";
          btn.style.backgroundColor = "#f44336";
          btn.style.color = "#fff";
          btn.style.border = "none";
          btn.style.fontSize = "12px";
          btn.style.borderRadius = "4px";
          card.style.position = "relative";
          card.appendChild(btn);
        } else if (!editMode) {
          const btn = card.querySelector(".edit-delete");
          if (btn) btn.remove();
        }
      });
    }

    // ã‚«ãƒ¼ãƒ‰éè¡¨ç¤º
    function hideCard(card) {
      card.style.display = "none";
      if (!card.id) card.id = "card-" + Math.random().toString(36).substr(2, 9);

      const hiddenCards = JSON.parse(localStorage.getItem(hiddenCardsKey) || "[]");
      if (!hiddenCards.includes(card.id)) hiddenCards.push(card.id);
      localStorage.setItem(hiddenCardsKey, JSON.stringify(hiddenCards));
    }

    // ã€Œï¼‹ã‚«ãƒ¼ãƒ‰è¿½åŠ ã€ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆä¿®æ­£ç‰ˆï¼‰
    addBtn.addEventListener("click", () => {
      const hiddenCards = JSON.parse(localStorage.getItem(hiddenCardsKey) || "[]");
      if (hiddenCards.length === 0) { alert("éè¡¨ç¤ºã‚«ãƒ¼ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“"); return; }

      const modal = document.createElement("div");
      modal.style.cssText = "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:10000;";

      const box = document.createElement("div");
      box.style.cssText = "padding:1rem;border-radius:8px;max-height:80%;overflow-y:auto;width:300px;";
      const theme = document.documentElement.getAttribute("data-theme") || "light";
      box.style.backgroundColor = theme === "dark" ? "#1e1e1e" : "#fff";
      box.style.color = theme === "dark" ? "#fff" : "#000";

      const title = document.createElement("h3");
      title.textContent = "éè¡¨ç¤ºã‚«ãƒ¼ãƒ‰ã‚’é¸æŠ";
      box.appendChild(title);

      hiddenCards.forEach(id => {
        const card = document.getElementById(id);
        if (!card) return;
        // â† offsetHeight ãƒã‚§ãƒƒã‚¯ã¯å‰Šé™¤
        const label = document.createElement("label");
        label.style.display = "block"; label.style.marginBottom = "0.4rem";
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox"; checkbox.value = id;
        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(" " + (card.querySelector("h2")?.textContent || id)));
        box.appendChild(label);
      });

      const addCardBtn = document.createElement("button");
      addCardBtn.textContent = "è¿½åŠ ";
      addCardBtn.style.cssText = "margin-top:0.5rem;padding:0.5rem 1rem;background:#4caf50;color:#fff;border:none;border-radius:6px;cursor:pointer;";
      addCardBtn.onclick = () => {
        const checkboxes = box.querySelectorAll("input[type=checkbox]");
        let updatedHidden = hiddenCards.slice();
        let order = JSON.parse(localStorage.getItem("widgetOrder") || "[]");

        checkboxes.forEach(cb => {
          if (cb.checked) {
            const card = document.getElementById(cb.value);
            if (card) {
              card.style.display = "block";
              if (!order.includes(card.id)) order.push(card.id);
            }
            updatedHidden = updatedHidden.filter(id => id !== cb.value);
          }
        });

        order.forEach(id => {
          const card = document.getElementById(id);
          if (card && card.style.display !== "none") widgets.appendChild(card);
        });

        localStorage.setItem(hiddenCardsKey, JSON.stringify(updatedHidden));
        localStorage.setItem("widgetOrder", JSON.stringify(order));
        document.body.removeChild(modal);
      };

      const closeBtn = document.createElement("button");
      closeBtn.textContent = "ã‚­ãƒ£ãƒ³ã‚»ãƒ«";
      closeBtn.style.cssText = "margin-top:0.5rem;margin-left:0.5rem;padding:0.5rem 1rem;background:#f44336;color:#fff;border:none;border-radius:6px;cursor:pointer;";
      closeBtn.onclick = () => document.body.removeChild(modal);

      box.appendChild(addCardBtn);
      box.appendChild(closeBtn);
      modal.appendChild(box);
      document.body.appendChild(modal);
    });

    // ã€Œã‚«ãƒ¼ãƒ‰é †åºå¤‰æ›´ã€ãƒ¢ãƒ¼ãƒ€ãƒ«
    sortBtn.addEventListener("click", () => {
      const visibleCards = Array.from(widgets.children)
        .filter(c => c.style.display !== "none" && c.offsetHeight > 0);
      if (visibleCards.length === 0) { alert("ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“"); return; }

      const modal = document.createElement("div");
      modal.style.cssText = "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:10000;";

      const box = document.createElement("div");
      box.style.cssText = "padding:1rem;border-radius:8px;max-height:80%;overflow-y:auto;width:350px;";
      const theme = document.documentElement.getAttribute("data-theme") || "light";
      box.style.backgroundColor = theme === "dark" ? "#1e1e1e" : "#fff";
      box.style.color = theme === "dark" ? "#fff" : "#000";

      const title = document.createElement("h3");
      title.textContent = "ã‚«ãƒ¼ãƒ‰é †åºå¤‰æ›´";
      box.appendChild(title);

      const list = document.createElement("div");
      list.style.display = "flex"; list.style.flexDirection = "column"; list.style.gap = "4px";
      box.appendChild(list);

      visibleCards.forEach(card => {
        if (card.offsetHeight === 0) return;
        const item = document.createElement("div");
        item.style.cssText = "display:flex;align-items:center;justify-content:space-between;padding:4px 6px;border:1px solid #ccc;border-radius:4px;";
        item.dataset.id = card.id;

        const label = document.createElement("span");
        label.textContent = card.querySelector("h2")?.textContent || card.id;
        item.appendChild(label);

        const btns = document.createElement("div");
        btns.style.display = "flex"; btns.style.gap = "2px";

        const upBtn = document.createElement("button"); upBtn.textContent = "â†‘"; upBtn.style.cursor = "pointer";
        upBtn.onclick = () => { const prev = item.previousElementSibling; if (prev) list.insertBefore(item, prev); };
        const downBtn = document.createElement("button"); downBtn.textContent = "â†“"; downBtn.style.cursor = "pointer";
        downBtn.onclick = () => { const next = item.nextElementSibling; if (next) list.insertBefore(next, item); };
        btns.appendChild(upBtn); btns.appendChild(downBtn);

        item.appendChild(btns);
        list.appendChild(item);
      });

      const saveBtn = document.createElement("button");
      saveBtn.textContent = "ä¿å­˜";
      saveBtn.style.cssText = "margin-top:0.5rem;padding:0.5rem 1rem;background:#4caf50;color:#fff;border:none;border-radius:6px;cursor:pointer;";
      saveBtn.onclick = () => {
        const newOrder = [];
        list.querySelectorAll("div[data-id]").forEach(item => newOrder.push(item.dataset.id));
        newOrder.forEach(id => {
          const card = document.getElementById(id);
          if (card && card.style.display !== "none") widgets.appendChild(card);
        });
        localStorage.setItem("widgetOrder", JSON.stringify(newOrder));
        document.body.removeChild(modal);
      };

      const closeBtnSort = document.createElement("button");
      closeBtnSort.textContent = "ã‚­ãƒ£ãƒ³ã‚»ãƒ«";
      closeBtnSort.style.cssText = "margin-top:0.5rem;margin-left:0.5rem;padding:0.5rem 1rem;background:#f44336;color:#fff;border:none;border-radius:6px;cursor:pointer;";
      closeBtnSort.onclick = () => document.body.removeChild(modal);

      box.appendChild(saveBtn);
      box.appendChild(closeBtnSort);
      modal.appendChild(box);
      document.body.appendChild(modal);
    });

    // ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
    let dragSrcEl = null;
    widgets.addEventListener("dragstart", e => {
      if (!editMode || !e.target.classList.contains("card")) return;
      dragSrcEl = e.target;
      e.dataTransfer.effectAllowed = "move";
    });
    widgets.addEventListener("dragover", e => {
      if (!editMode) return;
      e.preventDefault();
      const target = e.target.closest(".card");
      if (target && target !== dragSrcEl) {
        const rect = target.getBoundingClientRect();
        const next = (e.clientY - rect.top) / (rect.bottom - rect.top) > 0.5;
        widgets.insertBefore(dragSrcEl, next ? target.nextSibling : target);
      }
    });
  </script>


  <!-- ã‚°ãƒªãƒƒãƒ‰è‡ªå‹•ã‚µã‚¤ã‚º -->
  <script>
    function resizeGridItem(item) {
      const grid = document.querySelector(".widgets");
      if (!grid) return;
      const rowHeight = parseInt(window.getComputedStyle(grid).getPropertyValue('grid-auto-rows'));
      const rowGap = parseInt(window.getComputedStyle(grid).getPropertyValue('gap'));
      const itemHeight = item.getBoundingClientRect().height;
      const rowSpan = Math.ceil((itemHeight + rowGap) / (rowHeight + rowGap));
      item.style.setProperty('--row-span', rowSpan);
    }
    function resizeAllGridItems() {
      document.querySelectorAll(".widgets .card").forEach(resizeGridItem);
    }
    window.addEventListener("load", resizeAllGridItems);
    window.addEventListener("resize", resizeAllGridItems);
    const observer = new MutationObserver(resizeAllGridItems);
    observer.observe(document.querySelector(".widgets"), { childList: true, subtree: true });
  </script>

  <!-- å¤©æ°— -->
  <script>
    async function fetchWeather() {
      const container = document.getElementById('weather');
      container.innerHTML = '<div class="loading">å¤©æ°—æƒ…å ±ã‚’å–å¾—ä¸­â€¦</div>';

      try {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=35.2481&longitude=136.7846&current_weather=true&hourly=temperature_2m,weathercode&timezone=Asia/Tokyo`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();

        // ç¾åœ¨ã®è¦³æ¸¬æƒ…å ±
        const cw = data.current_weather;
        const dt = new Date(cw.time);
        const hour = dt.getHours();
        const emoji = weatherEmoji(cw.weathercode, hour);
        const timeStr = Intl.DateTimeFormat('ja-JP', { timeZone: 'Asia/Tokyo', hour: '2-digit', minute: '2-digit' }).format(dt);

        let html = `
        <div class="weather">
          <div class="icon">${emoji}</div>
          <div class="meta">
            <p><strong>ç¨²æ²¢å¸‚</strong><p>
            <p>æ›´æ–°æ—¥æ™‚: ${timeStr}</p>
            <p>æ°—æ¸©: <strong>${Math.floor(cw.temperature)}Â°C</strong> ï¼ é¢¨é€Ÿ: <strong>${cw.windspeed} m/s</strong></p>
          </div>
        </div>
        `;

        // hourly ãƒ‡ãƒ¼ã‚¿
        const hours = data.hourly.time;
        const temps = data.hourly.temperature_2m;
        const codes = data.hourly.weathercode;

        const now = new Date();
        let forecastRows = '';
        let added = 0;

        for (let i = 0; i < hours.length && added < 6; i++) {
          const d = new Date(hours[i]);
          // ä»Šã‚ˆã‚Šå¾Œã®æ™‚é–“ã§3æ™‚é–“å˜ä½ã®ã¿
          if (d > now && d.getHours() % 3 === 0) {
            const emoji2 = weatherEmoji(codes[i], d.getHours());
            forecastRows += `<tr><td>${d.getHours()}æ™‚</td><td>${Math.floor(temps[i])}Â°C</td><td>${emoji2}</td></tr>`;
            added++;
          }
        }

        html += `
        <table class="forecast">
          <thead>
            <tr><th>æ™‚åˆ»</th><th>æ°—æ¸©</th><th>å¤©æ°—</th></tr>
          </thead>
          <tbody>${forecastRows}</tbody>
        </table>
        `;

        // é€±é–“å¤©æ°—ã®ãƒ‡ãƒ¼ã‚¿å–å¾—
        const weeklyData = await fetchWeeklyWeather();

        html += `
        <h3>é€±é–“å¤©æ°—</h3>
        <div class="weekly-weather">
          ${weeklyData}
        </div>
        `;

        container.innerHTML = html;

      } catch (err) {
        container.innerHTML = `<div class="error">å¤©æ°—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ï¼ˆ${err.message}ï¼‰</div>`;
      }
    }

    // å¤©æ°—ã‚³ãƒ¼ãƒ‰ãƒãƒƒãƒ—
    const weatherCodeMap = {
      0: 'æ™´å¤©', 1: 'å°‘ã—æ›‡ã‚Š', 2: 'æ›‡ã‚Š', 3: 'åšã„é›²',
      45: 'éœ§', 48: 'éœ§ï¼ˆå‡çµï¼‰', 61: 'å°é›¨', 63: 'é›¨ï¼ˆä¸­ï¼‰',
      65: 'å¼·ã„é›¨', 71: 'é›ªï¼ˆè»½ï¼‰', 73: 'é›ªï¼ˆä¸­ï¼‰', 75: 'é›ªï¼ˆå¼·ï¼‰',
      80: 'ã«ã‚ã‹é›¨ï¼ˆå¼±ï¼‰', 81: 'ã«ã‚ã‹é›¨ï¼ˆä¸­ï¼‰', 82: 'ã«ã‚ã‹é›¨ï¼ˆå¼·ï¼‰',
      95: 'é›·é›¨'
    };

    // å¤©æ°—çµµæ–‡å­—åˆ¤å®š
    function weatherEmoji(code, hour) {
      const night = (hour < 6 || hour >= 18);
      if (code === 0) return night ? 'ğŸŒ™' : 'â˜€ï¸';
      if ([1, 2, 3].includes(code)) return 'â›…';
      if ([61, 63, 65, 80, 81, 82].includes(code)) return 'ğŸŒ§ï¸';
      if ([71, 73, 75].includes(code)) return 'â„ï¸';
      if (code === 95) return 'â›ˆï¸';
      return 'ğŸŒ¤ï¸';
    }

    // é€±é–“å¤©æ°—ã®ãƒ‡ãƒ¼ã‚¿å–å¾—
    async function fetchWeeklyWeather() {
      try {
        const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=35.2481&longitude=136.7846&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=Asia/Tokyo');
        const data = await res.json();
        const daily = data.daily;

        let html = "<table style='width:100%;border-collapse:collapse;margin-top:0.6rem;'>";
        html += "<tr><th>æ—¥ä»˜</th><th>æœ€é«˜æ°—æ¸©</th><th>æœ€ä½æ°—æ¸©</th><th>å¤©æ°—</th></tr>";
        for (let i = 0; i < daily.time.length; i++) {
          const d = new Date(daily.time[i]);
          const code = daily.weathercode[i];
          const emoji = weatherEmoji(code, 12);

          // æ›œæ—¥ã‚’å–å¾—
          const daysOfWeek = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
          const dayOfWeek = daysOfWeek[d.getDay()];

          // æœ€é«˜æ°—æ¸©ã¨_æœ€ä½æ°—æ¸©ã®è‰²ã‚’å¤‰æ›´
          const maxTemp = Math.floor(daily.temperature_2m_max[i]);
          const minTemp = Math.floor(daily.temperature_2m_min[i]);

          html += `
            <tr>
              <td style="text-align:center;">${d.getMonth() + 1}/${d.getDate()} (${dayOfWeek})</td>
              <td style="text-align:center;color:red;">${maxTemp}Â°C</td>
              <td style="text-align:center;color:#0096C7;">${minTemp}Â°C</td>
              <td style="text-align:center;">${emoji}</td>
            </tr>
          `;
        }
        html += "</table>";

        return html;
      } catch (e) {
        return "<div style='color:red;'>é€±é–“å¤©æ°—ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</div>";
      }
    }

    // åˆå›å–å¾— + 10åˆ†ã”ã¨ã«æ›´æ–°
    fetchWeather();
    setInterval(fetchWeather, 10 * 60 * 1000);
  </script>

  <script>
      // --- 2. ç°¡æ˜“ãƒ¡ãƒ¢å¸³ï¼ˆè‡ªå‹•ä¿å­˜ï¼‰ ---
      const memoArea = document.getElementById('simple-memo');
      const MEMO_KEY = 'portalMemo';

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¿å­˜ã•ã‚ŒãŸãƒ¡ãƒ¢ã‚’å¾©å…ƒ
      const savedMemo = localStorage.getItem(MEMO_KEY);
      if (savedMemo) {
        memoArea.value = savedMemo;
      }

      // å…¥åŠ›ã™ã‚‹ãŸã³ã«ä¿å­˜
      memoArea.addEventListener('input', () => {
        localStorage.setItem(MEMO_KEY, memoArea.value);
      });
  </script>

  <!-- åœ°éœ‡æƒ…å ± -->
  <script>
      /* =========================
         éœ‡åº¦å¤‰æ›
      ========================= */
      function sindo(scale) {
        switch (Number(scale)) {
          case 10: return "1";
          case 20: return "2";
          case 30: return "3";
          case 40: return "4";
          case 45: return "5å¼±";
          case 50: return "5å¼·";
          case 55: return "6å¼±";
          case 60: return "6å¼·";
          case 70: return "7";
        }
        return "ä¸æ˜(" + scale + ")";
      }

      function sindoClass(scale) {
        const s = Number(scale);
        if (s === 10) return "s1";
        if (s === 20) return "s2";
        if (s === 30) return "s3";
        if (s === 40) return "s4";
        if (s === 45) return "s5-weak";
        if (s === 50) return "s5-strong";
        if (s === 55) return "s6-weak";
        if (s === 60) return "s6-strong";
        if (s === 70) return "s7";
        return "";
      }

      function scaleBadgeClass(scale) {
        const s = Number(scale);
        if (s === 10) return "scale-1";
        if (s === 20) return "scale-2";
        if (s === 30) return "scale-3";
        if (s === 40) return "scale-4";
        if (s === 45 || s === 50) return "scale-5";
        if (s === 55 || s === 60) return "scale-6";
        if (s === 70) return "scale-7";
        return "scale-1";
      }

      /* =========================
         ã‚‚ã£ã¨è¦‹ã‚‹ç®¡ç†
      ========================= */
      let offset = 0;
      const limit = 3;
      let additionalItems = []; // è¿½åŠ åˆ†ã®<li>ã‚’ç®¡ç†

      /* =========================
         ãƒ‡ãƒ¼ã‚¿å–å¾—
      ========================= */
      async function fetchEarthquake() {
        const container = document.getElementById('result');
        const moreButton = document.getElementById('eq-load-more');
        const closeAllButton = document.getElementById('eq-close-all');

        if (offset === 0) {
          container.innerHTML = '<li class="loading">åœ°éœ‡æƒ…å ±ã‚’å–å¾—ä¸­â€¦</li>';
          moreButton.style.display = "inline-block";
          closeAllButton.style.display = "none";
          additionalItems = [];
        }

        try {
          const resp = await fetch(`https://api.p2pquake.net/v2/history?codes=551&limit=${limit}&offset=${offset}`);
          if (!resp.ok) throw new Error('HTTP ' + resp.status);
          const data = await resp.json();
          if (offset === 0) container.innerHTML = '';

          if (!Array.isArray(data) || data.length === 0) {
            moreButton.style.display = "none";
            closeAllButton.style.display = "none";
            return;
          }

          data.forEach(d => {
            const e = d.earthquake;
            const h = e.hypocenter || {};
            const p = d.points || [];
            const maxClass = sindoClass(e.maxScale);

            let pointsHtml = "";
            if (p.length === 0) pointsHtml = '<div class="point-row">å„åœ°ã®è©³ç´°ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
            else {
              p.forEach(pi => {
                const scText = sindo(pi.scale);
                const badgeClass = scaleBadgeClass(pi.scale);
                const addr = pi.addr ?? "";
                pointsHtml += `<div class="point-row">${pi.pref} ${addr} <span class="scale-badge ${badgeClass}">${scText}</span></div>`;
              });
            }

            const li = document.createElement('li');
            li.innerHTML = `
              <div class="eq ${maxClass}">
                <div class="meta">
                  <strong>æ™‚åˆ»:</strong> ${e.time}<br>
                  <strong>éœ‡æº:</strong> ${h.name || "ä¸æ˜"}<br>
                  <strong>ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰:</strong> ${h.magnitude || "-"}<br>
                  <strong>æœ€å¤§éœ‡åº¦:</strong> ${sindo(e.maxScale)}
                  <strong>æ·±åº¦:</strong> ${h.depth !== undefined ? h.depth + " km" : "-"}<br>
                </div>
              </div>
              <div class="ac-parent">å„åœ°ã®éœ‡åº¦ã‚’è¡¨ç¤º</div>
              <div class="ac-child" style="display:none;">${pointsHtml}</div>
            `;

            container.appendChild(li);

            // è¿½åŠ åˆ†ã¯é…åˆ—ã«æ ¼ç´
            if (offset > 0) additionalItems.push(li);
          });

         // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼ˆã‚¬ã‚¯ã‚¬ã‚¯é˜²æ­¢ãƒ»å…ˆè¡Œãƒªã‚µã‚¤ã‚ºç‰ˆï¼‰
          $(document).off("click", ".ac-parent");
          $(document).on("click", ".ac-parent", function() {
            const $child = $(this).next(".ac-child");
            const card = $(this).closest('.card')[0];

            if ($child.is(":hidden")) {
              // === é–‹ãã¨ã ===
              // 1. ã¾ãšä¸€ç¬ã ã‘ä¸­èº«ã‚’è¡¨ç¤ºçŠ¶æ…‹ã«ã—ã¦ã€æœ¬æ¥ã®é«˜ã•ã‚’è¨ˆç®—ã•ã›ã‚‹ï¼ˆç”»é¢ã«ã¯è¦‹ã›ãªã„ï¼‰
              $child.css({ display: 'block', visibility: 'hidden' });

              // 2. ã‚«ãƒ¼ãƒ‰ã®æ ã‚’ã€Œæœ€çµ‚çš„ãªå¤§ãã•ã€ã¾ã§ä¸€æ°—ã«åºƒã’ã‚‹
              if (typeof resizeGridItem === 'function') {
                resizeGridItem(card);
              }

              // 3. ä¸­èº«ã‚’éš ã—ã¦ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æº–å‚™
              $child.css({ display: 'none', visibility: 'visible' });

              // 4. åºƒãŒã£ãŸç©ºé–“ã«ã€ä¸­èº«ã‚’ã‚¹ãƒƒã¨æ»‘ã‚Šè¾¼ã¾ã›ã‚‹
              $child.slideDown(300);

            } else {
              // === é–‰ã˜ã‚‹ã¨ã ===
              // 1. å…ˆã«ä¸­èº«ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ç•³ã‚€
              $child.slideUp(300, function() {
                // 2. ç•³ã¿çµ‚ã‚ã£ãŸã‚‰ã€ã‚«ãƒ¼ãƒ‰ã®æ ã‚’ãƒ‘ãƒãƒƒã¨ç¸®ã‚ã‚‹
                if (typeof resizeGridItem === 'function') {
                  resizeGridItem(card);
                }
              });
            }
          });

          // ã‚‚ã£ã¨è¦‹ã‚‹å¾Œã¯é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³è¡¨ç¤º
          if (offset > 0 && additionalItems.length > 0) closeAllButton.style.display = "inline-block";

        } catch (err) {
          container.innerHTML = `<li class="error">åœ°éœ‡æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ï¼ˆ${err.message}ï¼‰</li>`;
          moreButton.style.display = "none";
          closeAllButton.style.display = "none";
        }
      }

      /* =========================
         åˆå›èª­ã¿è¾¼ã¿
      ========================= */
      fetchEarthquake();

      /* =========================
         ã‚‚ã£ã¨è¦‹ã‚‹ãƒœã‚¿ãƒ³
      ========================= */
      document.getElementById("eq-load-more").onclick = function() {
        offset += limit;
        fetchEarthquake();
      };

      /* =========================
         å…¨ã¦é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
      ========================= */
      document.getElementById("eq-close-all").onclick = function() {
        additionalItems.forEach(li => li.remove());
        additionalItems = [];
        this.style.display = "none";
        offset = 0; // offsetã‚‚ãƒªã‚»ãƒƒãƒˆ
      };

      /* =========================
         5åˆ†æ¯ã«ãƒªã‚»ãƒƒãƒˆã—ã¦æœ€æ–°3ä»¶
      ========================= */
      setInterval(() => {
        offset = 0;
        fetchEarthquake();
      }, 5 * 60 * 1000);
  </script>



  <!-- ç‚ºæ›¿ -->
  <script>
    async function fetchRate() {
      try {
        const res = await fetch('https://open.er-api.com/v6/latest/USD');
        const data = await res.json();
        if (data && data.rates && data.rates.JPY) {
          document.getElementById('exchange-rate').textContent = `1 ãƒ‰ãƒ« = ${data.rates.JPY.toFixed(2)} å††`;
        } else {
          document.getElementById('exchange-rate').textContent = 'ãƒ¬ãƒ¼ãƒˆå–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
        }
      } catch (err) { document.getElementById('exchange-rate').textContent = 'ãƒ¬ãƒ¼ãƒˆå–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ'; console.error(err); }
    }
    async function convertCurrency() {
      const amt = parseFloat(document.getElementById('amount').value);
      const from = document.getElementById('from').value;
      const to = document.getElementById('to').value;
      if (isNaN(amt)) { document.getElementById('currency-result').textContent = 'é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'; return; }
      try {
        const res = await fetch(`https://open.er-api.com/v6/latest/${from}`);
        const data = await res.json();
        if (data && data.rates && data.rates[to]) {
          const result = amt * data.rates[to];
          document.getElementById('currency-result').textContent = `${amt} ${from} = ${result.toFixed(2)} ${to}`;
        } else { document.getElementById('currency-result').textContent = 'æ›ç®—ã§ãã¾ã›ã‚“ã§ã—ãŸ'; }
      } catch (err) { document.getElementById('currency-result').textContent = 'æ›ç®—ã‚¨ãƒ©ãƒ¼: ' + err; console.error(err); }
    }
    fetchRate();
    document.getElementById('convert').addEventListener('click', convertCurrency);
  </script>

  <!-- ç‚ºæ›¿ã‚°ãƒ©ãƒ• -->
  <script>
      let rateChartInstance = null; // â† ã‚°ãƒ©ãƒ•ã‚’ä¿æŒã™ã‚‹å¤‰æ•°

      async function drawRateChart() {
        try {
          // CSSå¤‰æ•°ã‹ã‚‰ç¾åœ¨ã®è‰²ã‚’å†å–å¾—
          const rootStyle = getComputedStyle(document.documentElement);
          const gridColor = rootStyle.getPropertyValue('--text-color').trim();

          const end = new Date();
          const start = new Date();
          start.setDate(end.getDate() - 10);

          const url = `https://api.frankfurter.app/${start.toISOString().split('T')[0]}..${end.toISOString().split('T')[0]}?from=USD&to=JPY`;
          const res = await fetch(url);
          const data = await res.json();
          if (!data.rates) return;

          const labels = Object.keys(data.rates).sort();
          const values = labels.map(d => data.rates[d].JPY);

          const ctx = document.getElementById('rateChart').getContext('2d');

          // ã™ã§ã«ã‚°ãƒ©ãƒ•ãŒã‚ã‚‹å ´åˆ â†’ å‰Šé™¤ã—ã¦ä½œã‚Šç›´ã™
          if (rateChartInstance) {
            rateChartInstance.destroy();
          }

          rateChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
              labels,
              datasets: [{
                label: 'USD/JPY',
                data: values,
                borderColor: 'rgba(143, 207, 120,1)',
                backgroundColor: 'rgba(143, 207, 120,0.2)',
                fill: true,
                tension: 0.2
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: true,
              scales: {
                x: {
                  title: { display: true, text: 'æ—¥ä»˜' },
                  grid: { color: 'rgba(200, 200, 200, 1)' }
                },
                y: {
                  title: { display: true, text: 'ãƒ¬ãƒ¼ãƒˆ' },
                  grid: { color: 'rgba(200, 200, 200, 1)' }
                }
              },
              plugins: {
                legend: { display: false }
              }
            }
          });

        } catch (err) {
          console.error('ã‚°ãƒ©ãƒ•å–å¾—ã‚¨ãƒ©ãƒ¼:', err);
        }
      }

      // ---------- ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆæ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ ----------
      // ä¾‹ï¼šHTMLã§ <button id="themeToggle">åˆ‡æ›¿</button>
      document.getElementById("themeToggle")?.addEventListener("click", () => {
        // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆã®ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹ï¼‰
        document.body.classList.toggle("dark");

        // ã‚°ãƒ©ãƒ•ã®è‰²ã‚’å†å–å¾— & å†æç”»
        drawRateChart();
      });

      drawRateChart();
  </script>

  <!--ãƒ‹ãƒ¥ãƒ¼ã‚¹-->
  <script>
      async function fetchWithFallback(urls) {
        for (const url of urls) {
          try {
            const res = await fetch(url);
            if (res.ok) return await res.text();
          } catch (e) {
            // æ¬¡ã® URL ã‚’è©¦ã™
          }
        }
        throw new Error("å…¨ãƒ—ãƒ­ã‚­ã‚·å¤±æ•—");
      }

      async function fetchNews() {
        const container = document.getElementById('news-list');
        container.innerHTML = '<li class="loading">ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—ä¸­â€¦</li>';

        const rssUrl = 'https://news.yahoo.co.jp/rss/topics/domestic.xml';

        // â˜… Fallback ç”¨ãƒ—ãƒ­ã‚­ã‚·ä¸€è¦§
        const proxyList = [
          `https://api.allorigins.win/raw?url=${encodeURIComponent(rssUrl)}`,
          `https://cors.isteed.cc/?${encodeURIComponent(rssUrl)}`,
        ];

        try {
          // â˜… ã©ã‚Œã‹æˆåŠŸã—ãŸã‚‚ã®ã‚’å–å¾—
          const xmlText = await fetchWithFallback(proxyList);

          const parser = new DOMParser();
          const xml = parser.parseFromString(xmlText, "application/xml");
          const items = xml.querySelectorAll("item");

          container.innerHTML = '';
          if (!items || items.length === 0) {
            container.innerHTML = '<li>ãƒ‹ãƒ¥ãƒ¼ã‚¹æƒ…å ±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>';
            return;
          }

          items.forEach((item, idx) => {
            if (idx >= 10) return;

            const title = item.querySelector("title")?.textContent || 'æƒ…å ±ãªã—';
            const link = item.querySelector("link")?.textContent || '#';

            const li = document.createElement("li");
            li.innerHTML = `<a href="${link}" target="_blank"
              style="text-decoration:none;color:#2196f3;">${title}</a>`;
            container.appendChild(li);
          });

        } catch (err) {
          container.innerHTML = `<li class="error">ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ï¼ˆ${err.message}ï¼‰</li>`;
        }
      }

      fetchNews();
      setInterval(fetchNews, 15 * 60 * 1000);
  </script>


  <!--ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼-->
  <script>
    let currentYear, currentMonth;
    let holidaysData = {};  // ç¥æ—¥ã‚’ä¿æŒã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

    async function fetchHolidays(year) {
      try {
        const url = `https://holidays-jp.github.io/api/v1/${year}/date.json`;
        const resp = await fetch(url);
        if (!resp.ok) {
          console.warn("ç¥æ—¥ API ã‚¨ãƒ©ãƒ¼:", resp.status);
          return;
        }
        const data = await resp.json();
        holidaysData = data;
      } catch (err) {
        console.error("ç¥æ—¥å–å¾—å¤±æ•—:", err);
      }
    }

    async function generateCalendar(year, month) {
      const yearStr = String(year);
      if (!holidaysData || !Object.keys(holidaysData).some(d => d.startsWith(yearStr))) {
        await fetchHolidays(year);
      }

      const calendarContainer = document.getElementById("calendar");
      calendarContainer.innerHTML = "";

      const date = new Date(year, month - 1, 1);
      const today = new Date();
      const table = document.createElement("table");
      table.className = "calendar";

      const titleEl = document.getElementById("calendar-title");
      titleEl.textContent = `${year}å¹´ ${month}æœˆ`;

      const headerRow = document.createElement("tr");
      const days = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];
      days.forEach(d => {
        const th = document.createElement("th");
        th.textContent = d;
        headerRow.appendChild(th);
      });
      table.appendChild(headerRow);

      let row = document.createElement("tr");
      for (let i = 0; i < date.getDay(); i++) {
        const emptyCell = document.createElement("td");
        emptyCell.classList.add("empty"); // ç©ºã‚»ãƒ«
        row.appendChild(emptyCell);
      }

      while (date.getMonth() === month - 1) {
        const cell = document.createElement("td");
        const d = date.getDate();
        cell.textContent = d;

        const dayOfWeek = date.getDay();
        if (dayOfWeek === 0) cell.classList.add("sunday");
        else if (dayOfWeek === 6) cell.classList.add("saturday");

        const mm = String(month).padStart(2, "0");
        const dd = String(d).padStart(2, "0");
        const key = `${year}-${mm}-${dd}`;
        if (holidaysData[key]) {
          cell.classList.add("holiday");
          cell.title = holidaysData[key]; // ãƒ›ãƒãƒ¼ã§ç¥æ—¥åè¡¨ç¤º
        }

        if (
          date.getFullYear() === today.getFullYear() &&
          date.getMonth() === today.getMonth() &&
          date.getDate() === today.getDate()
        ) {
          cell.classList.add("today");
        }

        row.appendChild(cell);
        if (dayOfWeek === 6) {
          table.appendChild(row);
          row = document.createElement("tr");
        }

        date.setDate(d + 1);
      }

      // æœˆæœ«ã®æ®‹ã‚Šç©ºã‚»ãƒ«ã‚’åŸ‹ã‚ã‚‹
      if (row.children.length > 0 && row.children.length < 7) {
        for (let i = row.children.length; i < 7; i++) {
          const emptyCell = document.createElement("td");
          emptyCell.classList.add("empty"); // ç©ºã‚»ãƒ«
          row.appendChild(emptyCell);
        }
        table.appendChild(row);
      }

      calendarContainer.appendChild(table);
    }

    document.addEventListener("DOMContentLoaded", async () => {
      const now = new Date();
      currentYear = now.getFullYear();
      currentMonth = now.getMonth() + 1;
      await generateCalendar(currentYear, currentMonth);
    });

    document.getElementById("prev-month").addEventListener("click", async () => {
      currentMonth--;
      if (currentMonth < 1) {
        currentMonth = 12;
        currentYear--;
      }
      await generateCalendar(currentYear, currentMonth);
    });

    document.getElementById("next-month").addEventListener("click", async () => {
      currentMonth++;
      if (currentMonth > 12) {
        currentMonth = 1;
        currentYear++;
      }
      await generateCalendar(currentYear, currentMonth);
    });

    document.getElementById("today-month").addEventListener("click", async () => {
      const now = new Date();
      currentYear = now.getFullYear();
      currentMonth = now.getMonth() + 1;
      await generateCalendar(currentYear, currentMonth);
    });
  </script>

  <style>
    /* ç©ºã‚»ãƒ«ã®èƒŒæ™¯è‰²ï¼ˆãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨ï¼‰ */
    body.dark .calendar td.empty {
      background-color: #2a2a2a;
      /* ãŠå¥½ã¿ã®æ˜ã‚‹ã‚ç°è‰² */
    }
  </style>

  <!--æ˜Ÿåº§å ã„-->
  <script>
      // å ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§
      const HOROSCOPE_MESSAGES = [
        "å¤§å‰ï¼šæ–°ã—ã„æŒ‘æˆ¦ã«å‰ã€‚å°ã•ãªä¸€æ­©ã‚’è¸ã¿å‡ºãã†ã€‚",
        "ä¸­å‰ï¼šå®‰å®šé‹ã€‚è¨ˆç”»çš„ã«å‹•ãã¨å‰ã€‚",
        "å°å‰ï¼šã‚†ã£ãã‚Šä¼‘ã‚€ã¨é‹æ°—å›å¾©ã€‚",
        "å‰ï¼šå¹³ç©ã€‚ç„¦ã‚‰ãšä¸€ã¤ãšã¤ã€‚",
        "å‡¶ï¼šæ³¨æ„ãŒå¿…è¦ã€‚è½ã¡ç€ã„ã¦è¡Œå‹•ã‚’ã€‚"
      ];

      function drawHoroscope() {
        const select = document.getElementById('zodiac-select');
        const sign = select.value;
        const todayKey = new Date().toISOString().slice(0, 10);
        const storageKey = `horoscope_${todayKey}_${sign}`;
        const el = document.getElementById('horoscope-result');

        let msg = localStorage.getItem(storageKey);
        if (!msg) {
          const seed = Array.from(todayKey + sign).reduce((s, c) => s + c.charCodeAt(0), 0);
          const r = (seed * 9301 + 49297) % 233280;
          const idx = r % HOROSCOPE_MESSAGES.length;
          msg = HOROSCOPE_MESSAGES[idx];
          localStorage.setItem(storageKey, msg);
        }
        el.textContent = `${select.options[select.selectedIndex].text} â€” ${msg}`;
      }

      // ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆ
      document.getElementById('draw-horoscope').addEventListener('click', drawHoroscope);
  </script>

  <!--æ—¥ã®å‡ºãƒ»æ—¥ã®å…¥ã‚«ãƒ¼ãƒ‰ -->
  <script>
      async function fetchSunriseSunset() {
        const sunInfo = document.getElementById("sun-info");
        sunInfo.textContent = "èª­ã¿è¾¼ã¿ä¸­...";

        try {
          // ç¨²æ²¢å¸‚ï¼ˆç·¯åº¦ãƒ»çµŒåº¦ï¼‰
          const lat = 35.25;
          const lon = 136.78;

          const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=sunrise,sunset&timezone=Asia/Tokyo`;
          const response = await fetch(apiUrl);

          if (!response.ok) throw new Error("APIã‚¨ãƒ©ãƒ¼: " + response.status);
          const data = await response.json();

          if (!data.daily || !data.daily.sunrise || !data.daily.sunset) {
            sunInfo.textContent = "ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—";
            return;
          }

          // ä»Šæ—¥ã®æ—¥ä»˜ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ0ç•ªç›®ãŒä»Šæ—¥ï¼‰
          const sunrise = new Date(data.daily.sunrise[0]);
          const sunset = new Date(data.daily.sunset[0]);

          const sunriseTime = sunrise.toLocaleTimeString("ja-JP", { hour: "2-digit", minute: "2-digit" });
          const sunsetTime = sunset.toLocaleTimeString("ja-JP", { hour: "2-digit", minute: "2-digit" });

          sunInfo.innerHTML = `
            â˜€ï¸ æ—¥ã®å‡ºï¼š<strong>${sunriseTime}</strong><br>
            ğŸŒ‡ æ—¥ã®å…¥ï¼š<strong>${sunsetTime}</strong>
          `;
        } catch (err) {
          console.error(err);
          sunInfo.textContent = "æ—¥ã®å‡ºãƒ»æ—¥ã®å…¥ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
        }
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã«å®Ÿè¡Œ
      document.addEventListener("DOMContentLoaded", fetchSunriseSunset);
  </script>

  <script>
      async function fetchTrends() {
        const container = document.getElementById("trend-list");
        const STORAGE_KEY = "portalTrendCache";
        const CACHE_DURATION = 30 * 60 * 1000; // 30åˆ†é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥

        // --- 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯ ---
        // æ¯å›é€šä¿¡ã™ã‚‹ã¨é…ã„ã®ã§ã€å‰å›ã®ãƒ‡ãƒ¼ã‚¿ãŒæ–°é®®ãªã‚‰ãã‚Œã‚’ä½¿ã†
        try {
          const cached = JSON.parse(localStorage.getItem(STORAGE_KEY));
          if (cached && (Date.now() - cached.timestamp < CACHE_DURATION)) {
            console.log("ãƒˆãƒ¬ãƒ³ãƒ‰: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ã¾ã™");
            renderTrends(cached.data);
            return; // é€šä¿¡ã›ãšã«çµ‚äº†
          }
        } catch (e) {
          // ã‚­ãƒ£ãƒƒã‚·ãƒ¥èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ã—ã¦é€šä¿¡ã¸
        }

        container.innerHTML = '<li class="loading">é«˜é€Ÿå–å¾—ä¸­...</li>';

        // RSSã®URL
        const rssUrl = "https://trends.google.co.jp/trending/rss?geo=JP";

        // ä½¿ãˆã‚‹ãƒ—ãƒ­ã‚­ã‚·ã‚’å…¨éƒ¨ç”¨æ„ï¼ˆé¸æ‰‹ãŸã¡ï¼‰
        const proxies = [
          `https://api.allorigins.win/get?url=${encodeURIComponent(rssUrl)}&t=${Date.now()}`,
          `https://corsproxy.io/?${encodeURIComponent(rssUrl)}`,
          `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(rssUrl)}`
        ];

        try {
          // --- 2. ç«¶äº‰é–‹å§‹ (Promise.any) ---
          // å…¨å“¡åŒæ™‚ã«èµ°ã‚‰ã›ã¦ã€ä¸€ç•ªæœ€åˆã«æˆåŠŸã—ãŸçµæœã ã‘ã‚’å—ã‘å–ã‚‹
          const winnerResponse = await Promise.any(
            proxies.map(url => 
              fetch(url).then(async res => {
                if (!res.ok) throw new Error("HTTP error");
                // ãƒ—ãƒ­ã‚­ã‚·ã«ã‚ˆã£ã¦è¿”ã—æ–¹ãŒé•ã†ã®ã§çµ±ä¸€ã™ã‚‹
                const text = await res.text();
                // alloriginsã¯JSONã®ä¸­ã«contentsãŒã‚ã‚‹
                try {
                  const json = JSON.parse(text);
                  if (json.contents) return json.contents;
                } catch(e) {}
                return text; // ãã®ã¾ã¾ãƒ†ã‚­ã‚¹ãƒˆãªã‚‰ãã‚Œã‚’è¿”ã™
              })
            )
          );

          // æˆåŠŸã—ãŸã‚‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
          localStorage.setItem(STORAGE_KEY, JSON.stringify({
            timestamp: Date.now(),
            data: winnerResponse
          }));

          // æç”»
          renderTrends(winnerResponse);

        } catch (err) {
          console.error(err);
          container.innerHTML =
            `<li class="error" style="font-size:0.85rem;">å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>æ™‚é–“ã‚’ãŠã„ã¦ãã ã•ã„ã€‚</li>`;
        }
      }

      function renderTrends(xmlText) {
        const container = document.getElementById("trend-list");
        
        // è™¹ã‚«ãƒ©ãƒ¼è¨­å®š
        const rainbow10 = [
          "rgba(255, 0, 0, 0.25)", "rgba(255, 128, 0, 0.25)",
          "rgba(255, 230, 0, 0.25)", "rgba(180, 255, 0, 0.25)",
          "rgba(0, 200, 0, 0.25)", "rgba(0, 220, 255, 0.25)",
          "rgba(0, 120, 255, 0.25)", "rgba(0, 0, 255, 0.25)",
          "rgba(160, 0, 255, 0.25)", "rgba(255, 80, 160, 0.25)"
        ];

        try {
          const parser = new DOMParser();
          const xml = parser.parseFromString(xmlText, "application/xml"); // ã¾ãŸã¯ text/xml
          const items = xml.querySelectorAll("item");

          container.innerHTML = "";

          if (!items || items.length === 0) {
            // ãƒ‘ãƒ¼ã‚¹å¤±æ•—æ™‚ãªã©ã®ã‚¬ãƒ¼ãƒ‰
            container.innerHTML = "<li>ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚¨ãƒ©ãƒ¼</li>";
            return;
          }

          items.forEach((item, idx) => {
            if (idx >= 10) return;

            const title = item.querySelector("title")?.textContent || "æƒ…å ±ãªã—";
            const query = encodeURIComponent(title);
            const googleLink = `https://www.google.com/search?q=${query}`;

            const bg = rainbow10[idx];
            const hoverBg = bg.replace("0.25", "0.40");

            const li = document.createElement("li");
            li.innerHTML = `
              <a href="${googleLink}" target="_blank"
                style="
                  display: block;
                  padding: 10px 14px;
                  margin: 6px 0;
                  font-weight: 900;
                  color: var(--text-color);
                  background: ${bg};
                  border-radius: 10px;
                  cursor: pointer;
                  text-decoration: none;
                  transition: 0.2s;
                "
                onmouseover="this.style.background='${hoverBg}'"
                onmouseout="this.style.background='${bg}'"
              >
                ${title}
              </a>
            `;
            container.appendChild(li);
          });
        } catch(e) {
          container.innerHTML = "<li>è§£æã‚¨ãƒ©ãƒ¼</li>";
        }
      }

      // åˆå›å®Ÿè¡Œã¨å®šæœŸæ›´æ–°
      fetchTrends();
      // 30åˆ†ãŠãã«æ›´æ–°ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ™‚é–“ã¨åˆã‚ã›ã‚‹ï¼‰
      setInterval(fetchTrends, 30 * 60 * 1000);
  </script>

  <!--å ã„-->
 <script>
      function showFortune() {
        const resultEl = document.getElementById("fortune-result");
        
        // â˜…ã“ã“ã‚’è¿½åŠ ï¼šçµæœã®æ–‡å­—ã‚’å¸¸ã«çœŸã‚“ä¸­ã«æƒãˆã‚‹
        resultEl.style.textAlign = "center"; 
        
        const fortunes = [
          "å¤§å‰ï¼šä»Šæ—¥ã¯æœ€é«˜ã®ä¸€æ—¥ã«ãªã‚Šãã†ï¼",
          "ä¸­å‰ï¼šè‰¯ã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚æ…é‡ã«è¡Œå‹•ã‚’ã€‚",
          "å°å‰ï¼šç©ã‚„ã‹ãªæ—¥ã«ãªã‚Šãã†ã§ã™ã€‚",
          "å‰ï¼šã„ã¤ã‚‚é€šã‚Šã®å¹³å’Œãªæ—¥ã§ã™ã€‚",
          "å‡¶ï¼šæ³¨æ„ãŒå¿…è¦ãªä¸€æ—¥ã§ã™ã€‚"
        ];
        
        const result = fortunes[Math.floor(Math.random() * fortunes.length)];
        resultEl.textContent = result;

        // â˜…æ¼”å‡ºåˆ†å²
        if (result.includes("å¤§å‰")) {
          // 1. æ–‡å­—ã‚’è±ªè¯ã«ã™ã‚‹
          resultEl.style.color = "#FFD700"; // é‡‘è‰²
          resultEl.style.textShadow = "0px 0px 10px rgba(255, 215, 0, 0.8)"; // å…‰ã‚‰ã›ã‚‹
          // æ‹¡å¤§ã—ã¦ã‚‚ä½ç½®ãŒã‚ºãƒ¬ãªã„ã‚ˆã†ã«è¨­å®š
          resultEl.style.transformOrigin = "center center"; 
          resultEl.style.transform = "scale(1.15)"; // å°‘ã—å¤§ãã
          resultEl.style.transition = "0.3s";

          // 2. ç´™å¹é›ªã‚’ç™ºå°„ï¼
          var duration = 3 * 1000;
          var animationEnd = Date.now() + duration;
          var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999 };

          function randomInRange(min, max) {
            return Math.random() * (max - min) + min;
          }

          var interval = setInterval(function() {
            var timeLeft = animationEnd - Date.now();

            if (timeLeft <= 0) {
              return clearInterval(interval);
            }

            var particleCount = 50 * (timeLeft / duration);
            
            confetti(Object.assign({}, defaults, { 
              particleCount, 
              origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
              colors: ['#2196f3', '#FFD700', '#ff0000']
            }));
            confetti(Object.assign({}, defaults, { 
              particleCount, 
              origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
              colors: ['#2196f3', '#FFD700', '#ff0000']
            }));
          }, 250);

        } else if (result.includes("å‡¶")) {
          // å‡¶ã®ã¨ã
          resultEl.style.color = "#555";
          resultEl.style.textShadow = "none";
          resultEl.style.transform = "scale(1.0)";
        } else {
          // ãã‚Œä»¥å¤–
          resultEl.style.color = "var(--text-color)"; // å…ƒã®è‰²ã«æˆ»ã™
          resultEl.style.textShadow = "none";
          resultEl.style.transform = "scale(1.0)"; // å¤§ãã•ã‚’æˆ»ã™
        }
      }

      // ã‚«ãƒ¼ãƒ‰ã®éè¡¨ç¤ºãƒ»è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆï¼ˆæ—¢å­˜æ©Ÿèƒ½ç¶­æŒï¼‰
      window.addEventListener("DOMContentLoaded", () => {
        const visibility = JSON.parse(localStorage.getItem("cardVisibility") || "{}");
        const card = document.getElementById("fortune-card");
        if (card && visibility.hasOwnProperty("fortune-card")) {
          card.style.display = visibility["fortune-card"] ? "block" : "none";
        }
        
        // åˆæœŸçŠ¶æ…‹ã§ã‚‚ãŠã¿ãã˜ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®æƒãˆã«ã—ã¦ãŠã
        const resultEl = document.getElementById("fortune-result");
        if(resultEl) resultEl.style.textAlign = "center";
      });
  </script>



</body>

</html>
